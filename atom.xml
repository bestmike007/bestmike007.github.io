<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Mike's Blog]]></title>
  <link href="http://bestmike007.com/atom.xml" rel="self"/>
  <link href="http://bestmike007.com/"/>
  <updated>2014-11-03T10:20:28+08:00</updated>
  <id>http://bestmike007.com/</id>
  <author>
    <name><![CDATA[Mike He]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Applying Patches on Unsupported XenServer 6.2]]></title>
    <link href="http://bestmike007.com/blog/2014/10/31/applying-patches-on-unsupported-xenserver-6-dot-2/"/>
    <updated>2014-10-31T15:56:41+08:00</updated>
    <id>http://bestmike007.com/blog/2014/10/31/applying-patches-on-unsupported-xenserver-6-dot-2</id>
    <content type="html"><![CDATA[<p>It&rsquo;s easy to patch hostfixes through official XenCenter management software for XenServers with license, while without a license the XenServer have to be patched manually. Official website has an article on <a href="http://support.citrix.com/article/CTX132791L">how to apply a XenServer hotfix manually using the command line</a>. And this process is able to be done automatically with some scripts.</p>

<!--more-->


<h2>How to Patch</h2>

<p>Usually we use XenCenter to manage our standalone XenServers and XenServer clusters. XenCenter is checking for updates when connected to a XenServer (or pool master). It will show up like the following image.</p>

<p><img src="http://bestmike007.com/uploads/2014-10-31-applying-patches-on-unsupported-xenserver-6-dot-2/xencenter-update-notification.jpg"></p>

<p>By clicking the &lsquo;Go to the Web Page&hellip;&rsquo; button, the browser will open a web page to a support article introducing the details about the hotfix patch. And we are able to get the download link to the patch package after opening the &lsquo;Download Manager&rsquo; page.</p>

<p><img src="http://bestmike007.com/uploads/2014-10-31-applying-patches-on-unsupported-xenserver-6-dot-2/citrix-download-manager.jpg"></p>

<p>And we&rsquo;ll get a download like this: <code>http://downloadns.citrix.com.edgesuite.net/akdlm/*/XS*.zip</code>. With this link we can patch our XenServers by following the steps described in the <a href="http://support.citrix.com/article/CTX132791L">official article</a>.</p>

<h2>The Script</h2>

<p>We usually open the server (pool master if not standalone installation) console and enter several commands and copy &amp; paste intermediate outputs to apply the patch. So I have simplified the process by the following script.</p>

<pre>
#!/bin/bash
# install a update package from citrix
# e.g. http://downloadns.citrix.com.edgesuite.net/akdlm/*/XS*.zip
URL=$1
PKG=`basename $URL`
cd /tmp
mkdir update
cd update
wget -O $PKG $URL
unzip $PKG
for file in $(ls *.xsupdate); do ( xe patch-pool-apply uuid=`xe patch-upload file-name=$file` ) done
cd /tmp
rm -rf update
</pre>


<p>We can save this script to <code>/root/patch</code>. And with this script, we simply apply the patch by running a single command.</p>

<pre>bash# ./patch http://downloadns.citrix.com.edgesuite.net/akdlm/*/XS*.zip</pre>


<h2>Patch the Server Automatically</h2>

<p>You might be thinking that there have to be some update feed for XenCenter to check for updates, with which we are able to patch the server automatically. That&rsquo;s right. I found this tool: <a href="https://github.com/dalgibbard/citrix_xenserver_patcher">citrix_xenserver_patcher</a>. This tool use the <a href="http://updates.xensource.com/XenServer/updates.xml">patch feed</a> to check for updates and patch the server automatically.</p>

<p>And further more, we can also use cron jobs to patch the server silently. However I prefer patching the server with awareness in case of exceptions.</p>

<h2>How to Reboot after Patching XenServer Pool</h2>

<p>If we&rsquo;re patching a standalone XenServer, we need to stop or pause all the running VMs before rebooting the XenServer if reboot is required after the patch; while we&rsquo;re patching a XenServer pool, running VMs can be migrated to perform a sequential reboot without interrupting running services. Toolstacks of different versions might not be able to communicate correctly, for that we can proceed with the following steps:</p>

<ol>
<li>Restart toolstack on non-pool-master servers</li>
<li>Restart toolstack on pool master</li>
<li>Migrate VMs and reboot non-pool-master servers sequentially</li>
<li>Migrate VMs and reboot the pool master</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Resolve &#8216;Unknown Encoding&#8217; Error for Buffer in Node.js]]></title>
    <link href="http://bestmike007.com/2013/06/resolve-unknown-encoding-error-for-buffer-in-node-js/"/>
    <updated>2013-06-09T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2013/06/resolve-unknown-encoding-error-for-buffer-in-node-js</id>
    <content type="html"><![CDATA[<p>According to the official document for Buffer implementation, the Buffer class only supports a few encoding charsets including &#8216;ascii&#8217;, &#8216;utf8&#8242;, &#8216;utf16le&#8217;, &#8216;ucs2&#8242;, &#8216;base64&#8242;, &#8216;binary&#8217;, and &#8216;hex&#8217; [<a title="Node.js Buffer class" href="http://nodejs.org/api/buffer.html#buffer_buffer" target="_blank"><a href="http://nodejs.org/api/buffer.html#buffer_buffer">http://nodejs.org/api/buffer.html#buffer_buffer</a></a>]. So if you&#8217;re calling &#8216;toString&#8217; method from a Buffer instance you should probably get an &#8216;Unknown Encoding&#8217; error , e.g. reading a text file encoded by &#8216;latin1&#8242; or &#8216;ISO-8859-1&#8242;. This post provides a quick fix to this problem.</p>

<!--more-->


<p>This solution requires iconv. You can install it with npm.</p>

<pre>npm install iconv</pre>


<p>And then before using Buffer.toString method, override it with the following code.</p>

<pre>var Iconv = require('iconv').Iconv;

Buffer.prototype._$_toString = Buffer.prototype.toString;
Buffer.prototype.toString = function(charset) {
    if (typeof charset == 'undefined' || charset == 'utf8' || charset == 'utf16le' || charset == 'ascii' || charset == 'ucs2' || charset == 'binary' || charset == 'base64' || charset == 'hex') {
        return this._$_toString.apply(this, arguments);
    }
    var iconv = new Iconv(charset, 'UTF-8');
    var buffer = iconv.convert(this);
    var args = arguments;
    args[0] = 'utf8';
    return buffer.toString.apply(buffer, args);
}</pre>


<p>And that&#8217;s all.</p>

<p>P.S. This solution is originated from <a href="http://stackoverflow.com/questions/14551608/cant-find-encodings-for-node-js" target="_blank"><a href="http://stackoverflow.com/questions/14551608/cant-find-encodings-for-node-js">http://stackoverflow.com/questions/14551608/cant-find-encodings-for-node-js</a></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Free Lightweight Groupware Solution for Small Business]]></title>
    <link href="http://bestmike007.com/2012/09/free-lightweight-groupware-solution-for-small-business/"/>
    <updated>2012-09-03T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2012/09/free-lightweight-groupware-solution-for-small-business</id>
    <content type="html"><![CDATA[<p>It&#8217;s been a long time since my last blog post. Recently, I&#8217;ve been working on our own company since spring. We are planning to sell novel and creative things targeted United States market. As the director of the IT department of our company, I&#8217;ve been considering how everyone in our company can co-operate. We&#8217;re planning to deploy several common groupware systems, e.g. the bug tracking system, the internal wiki system, etc. And we also need an active directory to provide credentials for these systems.</p>

<!--more-->


<h2>The Problem</h2>

<p>Of course, the solution can be:</p>

<ol>
<li>Microsoft Exchange</li>
<li>VMWare Zimbra</li>
<li>Open X-change</li>
</ol>


<p>But Microsoft Exchange is too expensive for most small business companies to afford. We&#8217;ve been using Zimbra Community for a little while. It has most of the features we need including mail, calendar, ldap, etc. It&#8217;s really simple and easy to use, however, it has several disadvantages:</p>

<ol>
<li>Additional work for hardware maintenance</li>
<li>Risks of data loss caused by hardware failure</li>
<li>Not-quite-familiar user interfaces</li>
<li>No mobile support with community edition</li>
</ol>


<p>These advantages coalesced to force me reconsider another long-term solution. And this solution comes from the very simple principles resulting from trying to get rid of those disadvantages listed above. But how?</p>

<h2>The Solution</h2>

<p>First and foremost, pick up your most favorite email service provider, e.g. Gmail (with calendar and mobile access). Then create new accounts for everyone in your company. And enable IMAP for all these accounts.</p>

<p>Secondly, develop the ldap server. Don&#8217;t panic, it&#8217;s really simple with <a title="OpenDJ LDAP SDK" href="http://opendj.forgerock.org/opendj-ldap-sdk/" target="_blank">OpenDJ LDAP SDK</a>. It&#8217;s a simple delegate server which authenticate the users with the Gmail IMAP server. Just create a new Java application with the following code:</p>

<pre>/**
 *
 * @author Mike
 */
public class Server {
    /**
     * @param args the command line arguments
     */
     public static void main(String[] args) throws Exception {
        File csv = new File("address_biz.csv");
        System.out.println(csv.getAbsolutePath());
         final ServerConnectionFactory&lt;LDAPClientContext, Integer&gt; connectionHandler = Connections.newServerConnectionFactory(new IMAPBackend());
         final LDAPListenerOptions options = new LDAPListenerOptions().setBacklog(4096);
         LDAPListener listener = null;
         try {
             listener = new LDAPListener("0.0.0.0", 389, connectionHandler, options);
             System.out.println("Running the ldap server...");
             synchronized (listener) {
                 listener.wait();
             }
         } catch (Exception ex) {
             ex.printStackTrace(System.err);
         } finally {
             if (listener != null) {
                 listener.close();
             }
         }
     }
}</pre>


<p>IMAPBackend is the LDAP request handler:</p>

<pre>public class IMAPBackend implements RequestHandler&lt;RequestContext&gt; { ... }</pre>


<p>And we only implement 2 of those methods, the first one is the bind method:</p>

<pre>@Override
public void handleBind(RequestContext c, int i, BindRequest br, IntermediateResponseHandler irh, ResultHandler rh) {
    GenericBindRequest request = (GenericBindRequest) br;
    String dn = br.getName();
    System.out.println("Binding: " + dn);
    String pass = new String(request.getAuthenticationValue());
    String uid = "";
    for (String s : dn.split(",")) {
        s = s.trim();
        if (s.startsWith("uid=")) {
            uid = s.substring(4);
        }
    }

    Properties props = System.getProperties();
    props.setProperty("mail.store.protocol", "imaps");
    try {
        Session session = Session.getDefaultInstance(props, null);
        Store store = session.getStore("imaps");
        store.connect("imap.gmail.com", 993, uid + "@gmail.com", pass);
        store.close();
        rh.handleResult(Responses.newBindResult(ResultCode.SUCCESS));
        System.out.println("Bind " + uid + " success.");
    } catch (Exception ex) {
        //ex.printStackTrace(System.err);
        rh.handleResult(Responses.newBindResult(ResultCode.INVALID_CREDENTIALS));
        System.out.println("Bind " + uid + " fail.");
    }
}</pre>


<p>The second one is the search method, in which you need to maintain an address book for your company:</p>

<pre>@Override
public void handleSearch(RequestContext c, SearchRequest sr, IntermediateResponseHandler irh, SearchResultHandler srh) {
    System.out.println("Searching: " + sr.getFilter().toString());
    for (Entry e : load()) {
        if (sr.getFilter().matches(e).toBoolean()) {
            System.out.println("Search matched: " + e.getName());
            srh.handleEntry(Responses.newSearchResultEntry(e));
        }
    }
    srh.handleResult(Responses.newResult(ResultCode.SUCCESS));
}</pre>


<p>And you should implement the load function, for example the following code load the address book from a csv file:</p>

<pre>private static List load() {
    File csv = new File("address.csv");
    if (!csv.exists()) {
        return Collections.emptyList();
    }
    Scanner scanner = null;
    try {
        scanner = new Scanner(new InputStreamReader(new FileInputStream(csv)));
        scanner.nextLine();
        List list = new ArrayList();
        while (scanner.hasNextLine()) {
            String attrs[] = scanner.nextLine().split("\",\"");
            String name = attrs[0].substring(1);
            String email = attrs[1];
            String alias[] = attrs[2].split(",");
            String uid = email.substring(0, email.indexOf("@"));
            String ou = attrs[3];
            if (ou.isEmpty()) {
                continue;
            }
            Entry e = new LinkedHashMapEntry();
            e.setName(DN.valueOf(String.format("uid=%s,ou=people,dc=gmail,dc=com", uid)));
            e.addAttribute("uid", uid);
            e.addAttribute("cn", name);
            e.addAttribute("email", email);
            e.addAttribute("mail", email);
            e.addAttribute("ou", "people");
            list.add(e);
            for (String a : alias) {
                if (a.isEmpty()) {
                    continue;
                }
                uid = a.substring(0, a.indexOf("@"));
                e = new LinkedHashMapEntry();
                e.setName(DN.valueOf(String.format("uid=%s,ou=people,dc=gmail,dc=com", uid)));
                e.addAttribute("uid", uid);
                e.addAttribute("cn", name);
                e.addAttribute("email", a);
                e.addAttribute("mail", a);
                e.addAttribute("ou", "people");
                list.add(e);
            }
        }
        scanner.close();
        return list;
    } catch (Exception ex) {
        ex.printStackTrace(System.err);
        return Collections.emptyList();
    } finally {
        if (scanner != null) {
            scanner.close();
        }
    }
}</pre>


<p>And of course, you can implement your own search function with your preferred way to access your company address book. And that&#8217;s all for this ldap server.</p>

<p>At last, deploy the ldap server along with all the other groupware systems, e.g. MantisBT, mediawiki, etc.</p>

<p>Here is an example for the MantisBT configuration:</p>

<pre>$g_allow_signup = OFF;
$g_login_method = LDAP;
$g_ldap_server = 'ldap.example.com';
$g_ldap_root_dn = 'dc=gmail,dc=com';
$g_ldap_protocol_version = 3;
$g_ldap_bind_dn = 'uid=ldap.example.com,dc=gmail,dc=com';
$g_ldap_bind_passwd = 'internal_s3cret';
$g_use_ldap_email = ON;
$g_ldap_realname = 'cn';
$g_use_ldap_realname = ON;</pre>


<p>And the example configuration for media wiki:</p>

<pre>$wgGroupPermissions['*']['createaccount'] = false;
$wgGroupPermissions['*']['edit'] = false;
$wgGroupPermissions['*']['read'] = false;
$wgGroupPermissions['*']['createpage'] = false;
$wgGroupPermissions['*']['createtalk'] = false;
$wgGroupPermissions['*']['writeapi'] = false;

# LDAP
require_once( dirname( __FILE__ ) . "/extensions/LdapAuthentication/LdapAuthentication.php" );
$wgAuth = new LdapAuthenticationPlugin();

$wgLDAPDomainNames = array("example.com");
$wgLDAPDebug = 3; $wgDebugLogGroups["ldap"] = "/tmp/ldap.log" ;
$wgLDAPBaseDNs = array("example.com" =&gt; "dc=gmail,dc=com");
$wgLDAPServerNames = array("example.com" =&gt; "ldap.example.com");
$wgLDAPSearchAttributes = array('example.com' =&gt; "uid");
$wgLDAPEncryptionType = array("example.com" =&gt; "clear");
$wgLDAPProxyAgent = array("example.com" =&gt; "uid=ldap.example.com,dc=gmail,dc=com");
$wgLDAPProxyAgentPassword = array("example.com" =&gt; "internal_s3cret");</pre>


<h2> Conclusion</h2>

<p>This is a really simple solution which suit well for our company. We&#8217;re now using tencent enterprise email solution free edition with our own domain name. And we&#8217;re going to extend this whole system and make it robust for the long run. I sincerely hope that this can also help your business and please feel free to contact me (i &#8216;at&#8217; bestmike007.com). Thank you!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Secure Data Transmission between Pure PHP and JavaScript using RSA]]></title>
    <link href="http://bestmike007.com/2011/08/secure-data-transmission-between-pure-php-and-javascript-using-rsa/"/>
    <updated>2011-08-31T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2011/08/secure-data-transmission-between-pure-php-and-javascript-using-rsa</id>
    <content type="html"><![CDATA[<p>During the last few days I was looking for an approach to secure data transmission between server written in PHP and browser that runs JavaScript. I failed to find a direct solution, however I made some adaption to some of the existing open source projects and built my own solution to this problem.</p>

<!--more-->


<h2>The Existing Projects</h2>

<p>At the very beginning I found this: <a href="http://www.ohdave.com/rsa/">http://www.ohdave.com/rsa/</a></p>

<p>&nbsp;</p>

<p>It&#8217;s quite good solution for JavaScript and I searched for the correlated PHP solution and I found this easily: <a href="http://www.sematopia.com/2008/10/rsa-encrypting-in-javascript-and-decrypting-in-php/">http://www.sematopia.com/2008/10/rsa-encrypting-in-javascript-and-decrypting-in-php/</a></p>

<p>However, it uses the <a href="http://pear.php.net/package/Crypt_RSA/">Crypt_RSA package</a> with several dependencies and in some circumstances those packages would not be available. So I started to search for some pure PHP solution.</p>

<p>Then I found this one: <a href="http://code.google.com/p/bi2php/">http://code.google.com/p/bi2php/</a></p>

<p>I tried but failed to run this on my development computer with wamp running on Windows 2008r2.</p>

<p>And this one: <a href="http://stevish.com/rsa-encryption-in-pure-php">http://stevish.com/rsa-encryption-in-pure-php</a></p>

<p>I don&#8217;t know because I hadn&#8217;t tried to make it work because I failed to find a correlated JavaScript implementation.</p>

<p>And I found this from stanford: <a href="http://www-cs-students.stanford.edu/~tjw/jsbn/">http://www-cs-students.stanford.edu/~tjw/jsbn/</a></p>

<p>This is quite good except for the &#8220;message too long&#8221; limitation.</p>

<p>And <a href="https://ziyan.info/exibits/javascript-rsa/login.html">https://ziyan.info/exibits/javascript-rsa/login.html</a> is almost based on that.</p>

<p>At last I noticed <a href="http://phpseclib.sourceforge.net/">http://phpseclib.sourceforge.net/</a>. I&#8217;m quite sure it&#8217;s what I&#8217;m looking for and I tried to adapt it to the projects listed above but they all failed.</p>

<p>Then I tried to make some adaption for some of the JavaScript implementation and finally I built an adapted version of jsbn that works with phpseclib.</p>

<h2>The Solution</h2>

<p>This solution makes phpseclib works with RSA and ECC in JavaScript from <a href="http://www-cs-students.stanford.edu/~tjw/jsbn/">http://www-cs-students.stanford.edu/~tjw/jsbn/</a> with some modification.</p>

<ol>
<li>Edit the rsa.js, add a function after the RSAEncrypt function:</li>
</ol>


<pre>function RSAEncryptLong(text) {
  var length = ((this.n.bitLength()+7)&gt;&gt;3) - 11;
  if (length &lt;= 0) return false;
  var ret = "";
  var i = 0;
  while(i + length &lt; text.length) {
    ret += this._short_encrypt(text.substring(i,i+length));
    i += length;
  }
  ret += this._short_encrypt(text.substring(i,text.length));
  return ret;
}</pre>


<ol>
<li>modify the last line from</li>
</ol>


<pre>RSAKey.prototype.encrypt = RSAEncrypt;</pre>


<p>to:</p>

<pre>RSAKey.prototype._short_encrypt = RSAEncrypt;
RSAKey.prototype.encrypt = RSAEncryptLong;</pre>


<ol>
<li>When using phpseclib to decrypt the message, set the encrypt mode to PKCS1:</li>
</ol>


<pre>$rsa = new Crypt_RSA();
$rsa-&gt;setEncryptionMode(CRYPT_RSA_ENCRYPTION_PKCS1);</pre>


<h2> To Adopt the Solution</h2>

<ol>
<li>encrypt the message from browser:</li>
</ol>


<pre>&lt;script type="text/javascript" src="jsbn.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="prng4.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="rng.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="rsa.js"&gt;&lt;/script&gt;
&lt;script&gt;
function encrypt(msg) {
    var rsa = new RSAKey();
    rsa.setPublic('8a5f4d4fa7dd78ca8539ba8b9581b30c9ce04e1998cd881d5279221984bc606e2c7d3368dc184b357507966a0f20930ba665cd9e914d6b0b67c8636ffe8cacfd', '10001');
    return rsa.encrypt(msg);
}
&lt;/script&gt;</pre>


<ol>
<li>decrypt the message from the server using PHP:</li>
</ol>


<pre>require_once('Crypt/RSA.php');
define("KEY_PRIVATE", "-----BEGIN RSA PRIVATE KEY-----
MIIBOQIBAAJBAIpfTU+n3XjKhTm6i5WBswyc4E4ZmM2IHVJ5IhmEvGBuLH0zaNwYSzV1B5ZqDyCT
C6ZlzZ6RTWsLZ8hjb/6MrP0CAwEAAQJAAlK9TTln9No5nbwtvHHesWHaO5V0b6b5ubkXmHlrtuwR
nnNLGT9wqtIyP830/njo3qMFSIFKYGIErt+bSxEgBQIhAK5LTM2u2AudTUb6l1pi8qypXf7UHGUQ
bTxqPZaeh4gHAiEAyz0Wt0emBEieUDw7D4g3IXCb36cJcqDJ0OOz9rAwedsCIEV7QzzjrMDEjp/z
Gg8wTunCAvSpfkBT0hg5ih/XRtRVAiAQXVnf5iADBknhEgh7Zq9xvNyANLX5CeNWM4+BFIzCswIg
dGr1KW1fmIGJXoJ8qbFUbY7Bgk+cEc0kf2GvudfGQ5k=
-----END RSA PRIVATE KEY-----");

function decrypt(msg) {
    $rsa = new Crypt_RSA();
    $rsa-&gt;setEncryptionMode(CRYPT_RSA_ENCRYPTION_PKCS1);
    $rsa-&gt;loadKey(KEY_PRIVATE, CRYPT_RSA_PRIVATE_FORMAT_PKCS1);
    $s = new Math_BigInteger(msg, 16);
    retrun $rsa-&gt;decrypt($s-&gt;toBytes());
}</pre>


<ol>
<li>generate a new key pair:</li>
</ol>


<pre>require_once('Crypt/RSA.php');
define('CRYPT_RSA_MODE', CRYPT_RSA_MODE_INTERNAL);
$rsa = new Crypt_RSA();
$rsa-&gt;setPublicKeyFormat(CRYPT_RSA_PUBLIC_FORMAT_RAW);
$key = $rsa-&gt;createKey(512);
echo $key['privatekey'];
echo "\n";
$e = new Math_BigInteger($key['publickey']['e'], 10);
$n = new Math_BigInteger($key['publickey']['n'], 10);
echo "Public Key:\n";
echo $e-&gt;toHex();
echo "\n";
echo $n-&gt;toHex();</pre>


<p>At last is an example:</p>

<pre>&lt;?php
require_once('Crypt/RSA.php');
define("KEY_PRIVATE", "-----BEGIN RSA PRIVATE KEY-----
MIIBOQIBAAJBAIpfTU+n3XjKhTm6i5WBswyc4E4ZmM2IHVJ5IhmEvGBuLH0zaNwYSzV1B5ZqDyCT
C6ZlzZ6RTWsLZ8hjb/6MrP0CAwEAAQJAAlK9TTln9No5nbwtvHHesWHaO5V0b6b5ubkXmHlrtuwR
nnNLGT9wqtIyP830/njo3qMFSIFKYGIErt+bSxEgBQIhAK5LTM2u2AudTUb6l1pi8qypXf7UHGUQ
bTxqPZaeh4gHAiEAyz0Wt0emBEieUDw7D4g3IXCb36cJcqDJ0OOz9rAwedsCIEV7QzzjrMDEjp/z
Gg8wTunCAvSpfkBT0hg5ih/XRtRVAiAQXVnf5iADBknhEgh7Zq9xvNyANLX5CeNWM4+BFIzCswIg
dGr1KW1fmIGJXoJ8qbFUbY7Bgk+cEc0kf2GvudfGQ5k=
-----END RSA PRIVATE KEY-----");
function decrypt($msg) {
$rsa = new Crypt_RSA();
$rsa-&gt;setEncryptionMode(CRYPT_RSA_ENCRYPTION_PKCS1);
$rsa-&gt;loadKey(KEY_PRIVATE, CRYPT_RSA_PRIVATE_FORMAT_PKCS1);
$s = new Math_BigInteger($msg, 16);
return $rsa-&gt;decrypt($s-&gt;toBytes());
}
if(isset($_POST['submit'])) {
echo decrypt($_POST['enc_text']);
}
?&gt;
&lt;script type="text/javascript" src="jsbn.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="prng4.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="rng.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="rsa.js"&gt;&lt;/script&gt;
&lt;script&gt;
function encrypt() {
var rsa = new RSAKey();
rsa.setPublic('8a5f4d4fa7dd78ca8539ba8b9581b30c9ce04e1998cd881d5279221984bc606e2c7d3368dc184b357507966a0f20930ba665cd9e914d6b0b67c8636ffe8cacfd', '10001');
document.getElementById('enc_text').value = rsa.encrypt(document.getElementById('plaintext').value);
}
&lt;/script&gt;
&lt;form action="" method="post"&gt;
Plain Text:&lt;br/&gt;
&lt;input id='plaintext' type="text" size="40" value="test"/&gt;&lt;br/&gt;
&lt;input type="button" onclick="encrypt()" value="Encrypt"/&gt;&lt;br/&gt;
Encrypted Text:&lt;br/&gt;
&lt;input id="enc_text" name='enc_text' type="text" size="40"/&gt;&lt;br/&gt;
&lt;input name="submit" type="submit" value="Submit" size="10"/&gt;
&lt;/form&gt;</pre>


<h2> Finally</h2>

<p>I hope this solution would help some of you guys. Feel free to ask me questions, and if there&#8217;s something wrong with my article please help me to correct it.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Perplexity &#038; Cross-entropy]]></title>
    <link href="http://bestmike007.com/2011/07/perplexity-cross-entropy/"/>
    <updated>2011-07-23T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2011/07/perplexity-cross-entropy</id>
    <content type="html"><![CDATA[<p><a href="http://bestmike007.com/2011/07/perplexity-cross-entropy/a/" rel="attachment wp-att-41"><img class="alignnone size-full wp-image-41" title="Relation between Perplexity & Cross-entropy" src="http://bestmike007.com/uploads/2011/07/a.jpg" alt="" width="705" height="561" /></a>PS:</p>

<ol>
<li><p>Cross-entropy method website: <a href="http://iew3.technion.ac.il/CE/">http://iew3.technion.ac.il/CE/</a></p></li>
<li><p>Toolkits:</p></li>
</ol>


<p>SRILM: <a href="http://www-speech.sri.com/projects/srilm/">http://www-speech.sri.com/projects/srilm/</a></p>

<p>Another toolkit: <a href="http://mi.eng.cam.ac.uk/~prc14/toolkit.html">http://mi.eng.cam.ac.uk/~prc14/toolkit.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Porter Stemming Algorithm]]></title>
    <link href="http://bestmike007.com/2011/07/porter-stemming-algorithm/"/>
    <updated>2011-07-22T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2011/07/porter-stemming-algorithm</id>
    <content type="html"><![CDATA[<p>We think of the Porter algorithm as a lexicon-free FST stemmer.</p>

<p>Official website for this algorithm: <a href="http://tartarus.org/~martin/PorterStemmer/index.html">http://tartarus.org/~martin/PorterStemmer/index.html</a></p>

<!--more-->




<pre>/*

   Porter stemmer in Java. The original paper is in

       Porter, 1980, An algorithm for suffix stripping, Program, Vol. 14,
       no. 3, pp 130-137,

   See also http://www.tartarus.org/~martin/PorterStemmer

   History:

   Release 1

   Bug 1 (reported by Gonzalo Parra 16/10/99) fixed as marked below.
   The words 'aed', 'eed', 'oed' leave k at 'a' for step 3, and b[k-1]
   is then out outside the bounds of b.

   Release 2

   Similarly,

   Bug 2 (reported by Steve Dyrdahl 22/2/00) fixed as marked below.
   'ion' by itself leaves j = -1 in the test for 'ion' in step 5, and
   b[j] is then outside the bounds of b.

   Release 3

   Considerably revised 4/9/00 in the light of many helpful suggestions
   from Brian Goetz of Quiotix Corporation (brian@quiotix.com).

   Release 4

*/

import java.io.*;

/**
  * Stemmer, implementing the Porter Stemming Algorithm
  *
  * The Stemmer class transforms a word into its root form.  The input
  * word can be provided a character at time (by calling add()), or at once
  * by calling one of the various stem(something) methods.
  */

class Stemmer
{  private char[] b;
   private int i,     /* offset into b */
               i_end, /* offset to end of stemmed word */
               j, k;
   private static final int INC = 50;
                     /* unit of size whereby b is increased */
   public Stemmer()
   {  b = new char[INC];
      i = 0;
      i_end = 0;
   }

   /**
    * Add a character to the word being stemmed.  When you are finished
    * adding characters, you can call stem(void) to stem the word.
    */

   public void add(char ch)
   {  if (i == b.length)
      {  char[] new_b = new char[i+INC];
         for (int c = 0; c &lt; i; c++) new_b[c] = b[c];
         b = new_b;
      }
      b[i++] = ch;
   }

   /** Adds wLen characters to the word being stemmed contained in a portion
    * of a char[] array. This is like repeated calls of add(char ch), but
    * faster.
    */

   public void add(char[] w, int wLen)
   {  if (i+wLen &gt;= b.length)
      {  char[] new_b = new char[i+wLen+INC];
         for (int c = 0; c &lt; i; c++) new_b[c] = b[c];
         b = new_b;
      }
      for (int c = 0; c &lt; wLen; c++) b[i++] = w[c];
   }

   /**
    * After a word has been stemmed, it can be retrieved by toString(),
    * or a reference to the internal buffer can be retrieved by getResultBuffer
    * and getResultLength (which is generally more efficient.)
    */
   public String toString() { return new String(b,0,i_end); }

   /**
    * Returns the length of the word resulting from the stemming process.
    */
   public int getResultLength() { return i_end; }

   /**
    * Returns a reference to a character buffer containing the results of
    * the stemming process.  You also need to consult getResultLength()
    * to determine the length of the result.
    */
   public char[] getResultBuffer() { return b; }

   /* cons(i) is true &lt;=&gt; b[i] is a consonant. */

   private final boolean cons(int i)
   {  switch (b[i])
      {  case 'a': case 'e': case 'i': case 'o': case 'u': return false;
         case 'y': return (i==0) ? true : !cons(i-1);
         default: return true;
      }
   }

   /* m() measures the number of consonant sequences between 0 and j. if c is
      a consonant sequence and v a vowel sequence, and &lt;..&gt; indicates arbitrary
      presence,

         &lt;c&gt;&lt;v&gt;       gives 0
         &lt;c&gt;vc&lt;v&gt;     gives 1
         &lt;c&gt;vcvc&lt;v&gt;   gives 2
         &lt;c&gt;vcvcvc&lt;v&gt; gives 3
         ....
   */

   private final int m()
   {  int n = 0;
      int i = 0;
      while(true)
      {  if (i &gt; j) return n;
         if (! cons(i)) break; i++;
      }
      i++;
      while(true)
      {  while(true)
         {  if (i &gt; j) return n;
               if (cons(i)) break;
               i++;
         }
         i++;
         n++;
         while(true)
         {  if (i &gt; j) return n;
            if (! cons(i)) break;
            i++;
         }
         i++;
       }
   }

   /* vowelinstem() is true &lt;=&gt; 0,...j contains a vowel */

   private final boolean vowelinstem()
   {  int i; for (i = 0; i &lt;= j; i++) if (! cons(i)) return true;
      return false;
   }

   /* doublec(j) is true &lt;=&gt; j,(j-1) contain a double consonant. */

   private final boolean doublec(int j)
   {  if (j &lt; 1) return false;
      if (b[j] != b[j-1]) return false;
      return cons(j);
   }

   /* cvc(i) is true &lt;=&gt; i-2,i-1,i has the form consonant - vowel - consonant
      and also if the second c is not w,x or y. this is used when trying to
      restore an e at the end of a short word. e.g.

         cav(e), lov(e), hop(e), crim(e), but
         snow, box, tray.

   */

   private final boolean cvc(int i)
   {  if (i &lt; 2 || !cons(i) || cons(i-1) || !cons(i-2)) return false;
      {  int ch = b[i];
         if (ch == 'w' || ch == 'x' || ch == 'y') return false;
      }
      return true;
   }

   private final boolean ends(String s)
   {  int l = s.length();
      int o = k-l+1;
      if (o &lt; 0) return false;
      for (int i = 0; i &lt; l; i++) if (b[o+i] != s.charAt(i)) return false;
      j = k-l;
      return true;
   }

   /* setto(s) sets (j+1),...k to the characters in the string s, readjusting
      k. */

   private final void setto(String s)
   {  int l = s.length();
      int o = j+1;
      for (int i = 0; i &lt; l; i++) b[o+i] = s.charAt(i);
      k = j+l;
   }

   /* r(s) is used further down. */

   private final void r(String s) { if (m() &gt; 0) setto(s); }

   /* step1() gets rid of plurals and -ed or -ing. e.g.

          caresses  -&gt;  caress
          ponies    -&gt;  poni
          ties      -&gt;  ti
          caress    -&gt;  caress
          cats      -&gt;  cat

          feed      -&gt;  feed
          agreed    -&gt;  agree
          disabled  -&gt;  disable

          matting   -&gt;  mat
          mating    -&gt;  mate
          meeting   -&gt;  meet
          milling   -&gt;  mill
          messing   -&gt;  mess

          meetings  -&gt;  meet

   */

   private final void step1()
   {  if (b[k] == 's')
      {  if (ends("sses")) k -= 2; else
         if (ends("ies")) setto("i"); else
         if (b[k-1] != 's') k--;
      }
      if (ends("eed")) { if (m() &gt; 0) k--; } else
      if ((ends("ed") || ends("ing")) && vowelinstem())
      {  k = j;
         if (ends("at")) setto("ate"); else
         if (ends("bl")) setto("ble"); else
         if (ends("iz")) setto("ize"); else
         if (doublec(k))
         {  k--;
            {  int ch = b[k];
               if (ch == 'l' || ch == 's' || ch == 'z') k++;
            }
         }
         else if (m() == 1 && cvc(k)) setto("e");
     }
   }

   /* step2() turns terminal y to i when there is another vowel in the stem. */

   private final void step2() { if (ends("y") && vowelinstem()) b[k] = 'i'; }

   /* step3() maps double suffices to single ones. so -ization ( = -ize plus
      -ation) maps to -ize etc. note that the string before the suffix must give
      m() &gt; 0. */

   private final void step3() { if (k == 0) return; /* For Bug 1 */ switch (b[k-1])
   {
       case 'a': if (ends("ational")) { r("ate"); break; }
                 if (ends("tional")) { r("tion"); break; }
                 break;
       case 'c': if (ends("enci")) { r("ence"); break; }
                 if (ends("anci")) { r("ance"); break; }
                 break;
       case 'e': if (ends("izer")) { r("ize"); break; }
                 break;
       case 'l': if (ends("bli")) { r("ble"); break; }
                 if (ends("alli")) { r("al"); break; }
                 if (ends("entli")) { r("ent"); break; }
                 if (ends("eli")) { r("e"); break; }
                 if (ends("ousli")) { r("ous"); break; }
                 break;
       case 'o': if (ends("ization")) { r("ize"); break; }
                 if (ends("ation")) { r("ate"); break; }
                 if (ends("ator")) { r("ate"); break; }
                 break;
       case 's': if (ends("alism")) { r("al"); break; }
                 if (ends("iveness")) { r("ive"); break; }
                 if (ends("fulness")) { r("ful"); break; }
                 if (ends("ousness")) { r("ous"); break; }
                 break;
       case 't': if (ends("aliti")) { r("al"); break; }
                 if (ends("iviti")) { r("ive"); break; }
                 if (ends("biliti")) { r("ble"); break; }
                 break;
       case 'g': if (ends("logi")) { r("log"); break; }
   } }

   /* step4() deals with -ic-, -full, -ness etc. similar strategy to step3. */

   private final void step4() { switch (b[k])
   {
       case 'e': if (ends("icate")) { r("ic"); break; }
                 if (ends("ative")) { r(""); break; }
                 if (ends("alize")) { r("al"); break; }
                 break;
       case 'i': if (ends("iciti")) { r("ic"); break; }
                 break;
       case 'l': if (ends("ical")) { r("ic"); break; }
                 if (ends("ful")) { r(""); break; }
                 break;
       case 's': if (ends("ness")) { r(""); break; }
                 break;
   } }

   /* step5() takes off -ant, -ence etc., in context &lt;c&gt;vcvc&lt;v&gt;. */

   private final void step5()
   {   if (k == 0) return; /* for Bug 1 */ switch (b[k-1])
       {  case 'a': if (ends("al")) break; return;
          case 'c': if (ends("ance")) break;
                    if (ends("ence")) break; return;
          case 'e': if (ends("er")) break; return;
          case 'i': if (ends("ic")) break; return;
          case 'l': if (ends("able")) break;
                    if (ends("ible")) break; return;
          case 'n': if (ends("ant")) break;
                    if (ends("ement")) break;
                    if (ends("ment")) break;
                    /* element etc. not stripped before the m */
                    if (ends("ent")) break; return;
          case 'o': if (ends("ion") && j &gt;= 0 && (b[j] == 's' || b[j] == 't')) break;
                                    /* j &gt;= 0 fixes Bug 2 */
                    if (ends("ou")) break; return;
                    /* takes care of -ous */
          case 's': if (ends("ism")) break; return;
          case 't': if (ends("ate")) break;
                    if (ends("iti")) break; return;
          case 'u': if (ends("ous")) break; return;
          case 'v': if (ends("ive")) break; return;
          case 'z': if (ends("ize")) break; return;
          default: return;
       }
       if (m() &gt; 1) k = j;
   }

   /* step6() removes a final -e if m() &gt; 1. */

   private final void step6()
   {  j = k;
      if (b[k] == 'e')
      {  int a = m();
         if (a &gt; 1 || a == 1 && !cvc(k-1)) k--;
      }
      if (b[k] == 'l' && doublec(k) && m() &gt; 1) k--;
   }

   /** Stem the word placed into the Stemmer buffer through calls to add().
    * Returns true if the stemming process resulted in a word different
    * from the input.  You can retrieve the result with
    * getResultLength()/getResultBuffer() or toString().
    */
   public void stem()
   {  k = i - 1;
      if (k &gt; 1) { step1(); step2(); step3(); step4(); step5(); step6(); }
      i_end = k+1; i = 0;
   }

   /** Test program for demonstrating the Stemmer.  It reads text from a
    * a list of files, stems each word, and writes the result to standard
    * output. Note that the word stemmed is expected to be in lower case:
    * forcing lower case must be done outside the Stemmer class.
    * Usage: Stemmer file-name file-name ...
    */
   public static void main(String[] args)
   {
      char[] w = new char[501];
      Stemmer s = new Stemmer();
      for (int i = 0; i &lt; args.length; i++)
      try
      {
         FileInputStream in = new FileInputStream(args[i]);

         try
         { while(true)

           {  int ch = in.read();
              if (Character.isLetter((char) ch))
              {
                 int j = 0;
                 while(true)
                 {  ch = Character.toLowerCase((char) ch);
                    w[j] = (char) ch;
                    if (j &lt; 500) j++;
                    ch = in.read();
                    if (!Character.isLetter((char) ch))
                    {
                       /* to test add(char ch) */
                       for (int c = 0; c &lt; j; c++) s.add(w[c]);

                       /* or, to test add(char[] w, int j) */
                       /* s.add(w, j); */

                       s.stem();
                       {  String u;

                          /* and now, to test toString() : */
                          u = s.toString();

                          /* to test getResultBuffer(), getResultLength() : */
                          /* u = new String(s.getResultBuffer(), 0, s.getResultLength()); */

                          System.out.print(u);
                       }
                       break;
                    }
                 }
              }
              if (ch &lt; 0) break;
              System.out.print((char)ch);
           }
         }
         catch (IOException e)
         {  System.out.println("error reading " + args[i]);
            break;
         }
      }
      catch (FileNotFoundException e)
      {  System.out.println("file " + args[i] + " not found");
         break;
      }
   }
}</pre>


<p>&nbsp;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Oracle: maximum number of expressions in a list is 1000]]></title>
    <link href="http://bestmike007.com/2010/09/oracle-maximum-number-of-expressions-in-a-list-is-1000/"/>
    <updated>2010-09-23T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2010/09/oracle-maximum-number-of-expressions-in-a-list-is-1000</id>
    <content type="html"><![CDATA[<p>“I have a comma delimited list of many of IDs that I want to use in an IN clause, Sometimes this list can exceed 1000 items, at which point Oracle throws an error. The query is similar to this&#8230;” – from <a href="http://stackoverflow.com/questions/400255/how-to-put-more-than-1000-values-into-an-oracle-in-clause">http://stackoverflow.com/questions/400255/how-to-put-more-than-1000-values-into-an-oracle-in-clause</a></p>

<p>Recently I’ve encountered the same problem and I’m using Oracle11gR2.</p>

<p>Although it’s not recommended to have more than 1000 items in the IN clause list, we still need something to work around when sometimes it’s needed.</p>

<p>There might be some methods to work around this:</p>

<ol>
<li><p>Wrap the method which would possibly make a query contains an IN list which exceed 1000 items to divide the large query into subqueries.</p></li>
<li><p>Using or in the where clause:</p></li>
</ol>


<p>*select * from table1 where ID in (1,2,3,4,&#8230;,1000) or *</p>

<p><em>ID in (1001,1002,&#8230;,2000)</em></p>

<ol>
<li>Using union all</li>
</ol>


<p><em>select * from table1 where ID in (1,2,3,4,&#8230;,1000)</em></p>

<p><em>union all</em></p>

<p><em>select * from table1 where ID in (1001,1002,&#8230;,2000)</em></p>

<ol>
<li>Temp table of course, the worst solution I think.</li>
</ol>


<p>This problem does not appear to be in some of the other database systems.</p>

<p>If you’ve got some better solutions, please tell me.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Do Not Waste Your Time!!]]></title>
    <link href="http://bestmike007.com/2009/04/do-not-waste-your-time/"/>
    <updated>2009-04-18T00:00:00+08:00</updated>
    <id>http://bestmike007.com/2009/04/do-not-waste-your-time</id>
    <content type="html"><![CDATA[<div id="msgcns!F08B1508F28DDE0D!143" class="bvMsg">
  <div>
    　　If the real work that needs doing is offline, disable the internet for an hour at a time. <br />　　如果这件事情不需要上网就可以完成，把网断掉。 <br />　　 <br />　　Turn email checks into an hourly habit, not an “as the box gets mail” habit. <br />　　延长查看电子邮件的周期。 <br />　　 <br />　　Don’t answer your cell phone when working on something important. Call back later. <br />　　如果手头的工作很重要，工作期间不要接电话，回头再打过去就是了。 <br />　　 <br />　　If you can’t work at work, negotiate finding a new place to get things done. <br />　　如果你的工作环境让你不能工作，换个没人打扰的地方 <br />　　 <br />　　Television means: “I don’t need this time and it doesn’t matter to me.” (Almost always. Really.) <br />　　看电视意味着“这段时间我浪费了也无所谓”。 <br />　　 <br />　　Bugdet your entertainment time vs. production time. Never cheat the other. <br />　　平衡你的娱乐和工作时间。 <br />　　 <br />　　Examine every opportunity along the lines of time vs. projects already underway. <br />　　时时检查你的时间安排和现在已经进行中的项目。 <br />　　 <br />　　Try working part of your day in “off-hour” times, to get more done with fewer people around. <br />　　以小时为单位划分你的工作时间，用更少的人做更多的事情。 <br />　　 <br />　　 <br />　　 <br />　　 <br />　　 <br />　　专心的窍门 <br />　　 <br />　　Write your goals clearly. Post them in eyeball view of where you work most. <br />　　清楚的写下你的目标。放在你的眼皮底下。 <br />　　 <br />　　Spend time with focused people. Meet and befriend those who are where you want to be. <br />　　多和专心工作的人在一起。 <br />　　 <br />　　Consume as much material about your prime focus as you can budget. <br />　　尽量把资源用在主要目标上，把时间花在刀刃上。 <br />　　 <br />　　Analyze your past experiences. Be clear. List your successes. Examine your failures. <br />　　回顾总结以往的成功和失败经验。 <br />　　 <br />　　Stay true to a particular vision of what you want to do. <br />　　清楚明白你想要得到的是什么。 <br />　　 <br />　　Don’t give up too early. <br />　　不要太容易放弃。 <br />　　 <br />　　Envision your success. Write about it. Then read that daily or weekly. <br />　　想象一下成功后的样子，写下来，每天读读。 <br />　　 <br />　　Learn how to “chunk.” Hit each milestone and move to the next. Be methodical. <br />　　学会把大事划分为几个阶段，完成一个阶段，再进入下一个。 <br />　　 <br />　　Develop habits around success and drive. <br />　　养成好习惯。 <br />　　 <br />　　Recharge your batteries with good sleep and food. <br />　　吃好睡足。 <br />　　 <br />　　Develop your relationship with your family. It nourishes the other goals. <br />　　维持家庭关系。这是你完成其它工作的保障。。。
  </div>
</div>

]]></content>
  </entry>
  
</feed>
